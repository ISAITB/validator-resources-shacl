# baseURI: http://www.w3.org/ns/shacl-shacl#

# A SHACL shapes graph to validate Best Practices on SHACL shapes graphs
# First edited 2020-03-12
# Last edited 2020-08-26

@prefix rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sh:   <http://www.w3.org/ns/shacl#> .
@prefix xsd:  <http://www.w3.org/2001/XMLSchema#> .

@prefix bpsh: <http://itb.ec.europa.eu/ns/shacl-shacl-bp#> .

bpsh:UniqueLangShape			# text-language and label-nodeshape
	a sh:NodeShape ;
	sh:targetSubjectsOf sh:description, sh:name, sh:message ;
	
	rdfs:comment "One value per language tag warning for sh:name, sh:description, sh:message properties."@en ;
	rdfs:label "Unique Lang Shape"@en ;
	
	sh:property bpsh:UniqueLangDescriptionShape ;
	sh:property bpsh:UniqueLangNameShape ;
	sh:property bpsh:UniqueLangMessageShape .


bpsh:UniqueLangDescriptionShape 
	a sh:PropertyShape ;
	
	sh:name "Unique Lang Description property"@en ;
	sh:description "One value per language tag warning for sh:description properties."@en ;
		
	sh:path sh:description ;				
	sh:message "Both sh:name and sh:description may have multiple values, but should only have one value per language tag."@en;
	sh:uniqueLang true ;	
	sh:severity sh:Warning .


bpsh:UniqueLangNameShape
	a sh:PropertyShape ;
	
	sh:name "Unique Lang Name property"@en ;
	sh:description "One value per language tag warning for sh:name properties."@en ;
	
	sh:path sh:name ;				
	sh:message "Both sh:name and sh:description may have multiple values, but should only have one value per language tag."@en;
	sh:uniqueLang true ;
	sh:severity sh:Warning .


bpsh:UniqueLangMessageShape
	a sh:PropertyShape ;	
	
	sh:name "Unique Lang Message property"@en ;
	sh:description "One value per language tag warning for sh:message properties."@en ;
	
	sh:path sh:message ;				
	sh:message "A shape should not have more than one value for sh:message with the same language tag."@en;
	sh:uniqueLang true ;
	sh:severity sh:Warning .
	
	
bpsh:MessageNodeShapePropertyShapeShape				# message
	a sh:NodeShape ;
	sh:targetClass sh:NodeShape ;
	sh:targetClass sh:PropertyShape ;
	
	rdfs:comment "Minimum requirements for sh:message property in SHACL."@en ;
	rdfs:label "Message Shape"@en ;
	
	sh:message "A shape should have at least one value for sh:message in the shapes graph, then all validation results produced as a result of the shape will have exactly these messages as their value of sh:resultMessage."@en;
	sh:severity sh:Warning ;
	
	sh:or (
		sh:property [
				sh:path sh:message ;
				sh:minCount 1 ;
		]
		sh:property [
				sh:path (sh:property sh:message) ;
				sh:minCount 1 ;
		]
		sh:property [
				sh:path (sh:qualifiedValueShape sh:message) ;
				sh:minCount 1 ;
		]
		sh:property [
				sh:path (sh:property sh:node) ;
				sh:minCount 1 ;
		]
	)  .
	
bpsh:NodeShapeShape			# label-nodeshape
	a sh:NodeShape ;
	sh:targetClass sh:NodeShape ;
	
	rdfs:comment "One value per language tag warning for rdfs:label, rdfs:comment properties."@en ;
	rdfs:label "Nodeshape Shape"@en ;
	
	sh:message "Every NodeShape SHOULD contain rdfs:label and rdfs:comment, and they SHOULD only have one value per language tag."@en;
	sh:severity sh:Warning ;
	
	sh:and(
		sh:property bpsh:UniqueLangLabelShape 
		sh:property bpsh:UniqueLangCommentShape 
	) .


bpsh:UniqueLangCommentShape
	a sh:PropertyShape ;	
	
	sh:name "Unique Lang Label property"@en ;
	sh:description "One value per language tag warning for rdfs:comment propert."@en ;
	
	sh:path rdfs:comment ;				
	sh:uniqueLang true ;
	sh:minCount 1 .


bpsh:UniqueLangLabelShape
	a sh:PropertyShape ;	
	
	sh:name "Unique Lang Label property"@en ;
	sh:description "One value per language tag warning for rdfs:label propert."@en ;
	
	sh:path rdfs:label ;				
	sh:uniqueLang true ;
	sh:minCount 1 .
	
	
bpsh:PropertyShapeShape			# name-property and description-property
	a sh:NodeShape ;
	sh:targetClass sh:PropertyShape ;
	sh:targetObjectsOf sh:property ;
	
	rdfs:comment "Minimum count for sh:name and sh:description in sh:PropertyShape."@en ;
	rdfs:label "PropertyShape Shape"@en ;
	
	sh:property bpsh:CountNameProperty ;
	sh:property bpsh:CountDescriptionProperty .
	

bpsh:CountNameProperty 			# name-property 
	a sh:PropertyShape ;
	
	sh:name "Name property"@en ;
	sh:description "Minimum count for sh:name."@en ;
		
	sh:path sh:name ;				
	sh:message "Each property SHALL have a sh:name (in the context of the target where it appears) to provide human-oriented labels. This is the preferred alternative to overwriting rdfs:labels coming from external foreign vocabularies to fit the context better."@en;
	sh:minCount 1 ;
	sh:severity sh:Warning .	
	

bpsh:CountDescriptionProperty 			# description-property 
	a sh:PropertyShape ;
	
	sh:name "Description property"@en ;
	sh:description "Minimum count for sh:description."@en ;
		
	sh:path sh:description ;				
	sh:message "Each property SHOULD have sh:description (in the context of the target where it appears) to provide further human-oriented details. This is the preferred solution over adding additional usage notes to fit the context."@en;
	sh:minCount 1 ;
	sh:severity sh:Warning .	
	
	