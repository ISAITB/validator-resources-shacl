# baseURI: http://www.w3.org/ns/shacl-shacl#

# A SHACL shapes graph to validate Best Practices on SHACL shapes graphs
# First edited 2020-03-12
# Last edited 2020-08-26

@prefix rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sh:   <http://www.w3.org/ns/shacl#> .
@prefix xsd:  <http://www.w3.org/2001/XMLSchema#> .

@prefix adsh: <http://www.w3.org/ns/advanced-shacl#> .

adsh:
	rdfs:label "Advanced Features for SHACL"@en ;
	rdfs:comment "This shapes graph can be used to validate SHACL shapes graphs against a subset of advanced features of SHACL."@en ;
	sh:declare [
		sh:prefix "adsh" ;
		sh:namespace "http://www.w3.org/ns/advanced-shacl#"^^xsd:anyURI ;
	] .

adsh:TargetShape
	a sh:NodeShape ;
	sh:targetSubjectsOf sh:target ;
		
	rdfs:comment "Requirements for subjects of sh:target class."@en ;
	rdfs:label "Target Shape"@en ;
	
	sh:property [
		sh:name "Node Kind at Target class"@en ;
		
		sh:path sh:target ;				
		sh:message "The values of sh:target at a shape are IRIs or blank nodes."@en;
		sh:or ( [ sh:nodeKind sh:BlankNode ] [ sh:nodeKind sh:IRI ] ) ;		# target-nodeKind
	] .


adsh:SPARQLTargetShape
	a sh:NodeShape ;			
	sh:targetClass sh:SPARQLTarget ;
	
	rdfs:comment "Requirements for sh:SPARQLTarget class."@en ;
	rdfs:label "SPARQL Target Shape"@en ;
	
	sh:property [
		sh:name "Count Select at SPARQL Target class"@en ;
		
		sh:path sh:select ;
		sh:message "SPARQL-based targets have exactly one value for the property sh:select."@en;
		sh:maxCount 1 ;					# SPARQLTarget-select-count
		sh:minCount 1 ;					# SPARQLTarget-select-count
	] ;	
	
	sh:property [
		sh:name "Node Kind at SPARQL Target class"@en ;
		
		sh:path sh:prefixes ;
		sh:message "SPARQL-based targets may have values for the property sh:prefixes and these values are IRIs or blank nodes."@en;
		sh:or ( [ sh:nodeKind sh:BlankNode ] [ sh:nodeKind sh:IRI ] ) ;		# SPARQLTarget-prefixes-nodeKind
	] ;
	
	sh:property [
		sh:name "Pattern at SPARQL Target class"@en ;
		
		sh:path sh:select ;
		sh:message "Using the values of sh:prefixes as defined by 5.2.1 Prefix Declarations for SPARQL Queries, the values of sh:select must be valid SPARQL 1.1 SELECT queries with a single result variable this."@en;
		sh:pattern "^\\s*(SELECT)\\s+(\\?this)\\s+(WHERE)\\s+\\{.*" ;		# SPARQLTarget-select-sparql
		sh:flags "si" ;		
	] ;	
	
	sh:property [
		sh:name "Count Ask at SPARQL Target class"@en ;
		
		sh:path sh:ask ;
		sh:message "SPARQL-based targets have at most one value for the property sh:ask."@en;
		sh:maxCount 1 ;					# SPARQLTarget-ask-count
	] .

	
adsh:ResultAnnotationShape
	a sh:NodeShape ;
	sh:targetSubjectsOf sh:resultAnnotation ;
	
	rdfs:comment "Requirements for subjects of sh:resultAnnotation class."@en ;
	rdfs:label "Result Annotation Shape"@en ;
	
	sh:property [
		sh:name "Node kind at Result Annotation class"@en ;
		
		sh:path sh:resultAnnotation ;				
		sh:message "The values of sh:resultAnnotation are called result annotations and are either IRIs or blank nodes."@en ;
		sh:or ( [ sh:nodeKind sh:BlankNode ] [ sh:nodeKind sh:IRI ] ) ;		# resultAnnotation-nodeKind
	] ;
	
	sh:property [
		sh:name "Count AnnotationProperty at Result Annotation class"@en ;
		
		sh:path (sh:resultAnnotation sh:annotationProperty) ;
		sh:message "Each result annotation has exactly one value for the property sh:annotationProperty and this value is an IRI."@en ;
		sh:maxCount 1 ;					# annotationProperty
		sh:minCount 1 ;					# annotationProperty
	] ;
	
	sh:property [
		sh:name "Count AnnotationVarName at Result Annotation class"@en ;
		
		sh:path (sh:resultAnnotation sh:annotationVarName) ;
		sh:message "Each result annotation has at most 1 value for the property sh:annotationVarName."@en ;
		sh:maxCount 1 ;					# annotationVarName
	] ;
	
	sh:property [
		sh:name "AnnotationVarName datatype at Result Annotation class"@en ;
		
		sh:path (sh:resultAnnotation sh:annotationVarName) ;
		sh:message "The value of sh:annotationVarName must be a literal with datatype xsd:string."@en ;
		sh:datatype xsd:string ;	 				# annotationVarName
	] .
	

adsh:ReturnTypeShape
	a sh:NodeShape ;
	sh:targetSubjectsOf sh:returnType ;	
	
	rdfs:comment "Requirements for subjects of sh:returnType class."@en ;
	rdfs:label "Return Type Shape"@en ;
	
	sh:property [
		sh:name "Count Return Type class"@en ;
		
		sh:path sh:returnType ;
		sh:message "A function has at most one value for sh:returnType."@en ;
		sh:maxCount 1 ;					# returnType-maxCount
	] ;
	
	sh:property [
		sh:name "Node Kind Return Type class"@en ;
		
		sh:path sh:returnType ;				
		sh:message "The values of sh:returnType are IRIs."@en ;
		sh:nodeKind sh:IRI ;		# returnType-nodeKind
	] .
	
adsh:SPARQLFunctionShape
	a sh:NodeShape ;			
	sh:targetClass sh:SPARQLFunction ;	
	sh:message "SPARQL-based functions have exactly one value for either sh:ask or sh:select."@en ;
	
	rdfs:comment "Requirements for sh:SPARQLFunction class."@en ;
	rdfs:label "SPARQL Function Shape"@en ;
	
	sh:xone (						# SPARQLFunction-query
		[
			sh:property [
				sh:name "Count Ask at SPARQL Function class"@en ;
				
				sh:path sh:ask ;
				sh:maxCount 1 ;	
				sh:minCount 1 ;
			]
		]
		[
			sh:property [
				sh:name "Count Select at SPARQL Function class"@en ;
				
				sh:path sh:select ;
				sh:maxCount 1 ;	
				sh:minCount 1 ;
			] 
		]
	)  .
	
adsh:FilterShapeShape			# FilterShapeExpression
	a sh:NodeShape ;
	sh:targetSubjectsOf sh:filterShape ;
	sh:message "A filter shape expression is a blank node with exactly one value for sh:filterShape (which is a well-formed shape) and exactly one value for sh:nodes (which is a well-formed node expression)."@en ;
	
	rdfs:comment "Requirements for subjects of sh:filterShape class."@en ;
	rdfs:label "Filter Shape Shape"@en ;
	
	sh:and (
		sh:property [
			sh:name "Filter Shape requirements at Filter Shape class"@en ;
			
			sh:path sh:filterShape ;
			sh:maxCount 1 ;
			sh:minCount 1 ;
			sh:or ( [ sh:nodeKind sh:BlankNode ] [ sh:nodeKind sh:IRI ] ) ;	
		] 
		sh:property [
			sh:name "Count Nodes at Filter Shape class"@en ;
		
			sh:path sh:nodes ;
			sh:maxCount 1 ;
			sh:minCount 1 ;
		] 
	) .
	
	
adsh:PathExpressionShape			# PathExpression
	a sh:NodeShape ;
	sh:targetSubjectsOf sh:path ;
	sh:message "A path expression is a blank node with exactly one value of the property sh:path (which are well-formed property paths) and at most one value for sh:nodes (which is a well-formed node expression)."@en ;
	
	rdfs:comment "Requirements for subjects of sh:path class."@en ;
	rdfs:label "Path Expression Shape"@en ;
	
	sh:and (
		sh:property [
			sh:name "Count Path class"@en ;
			
			sh:path sh:path ;
			sh:maxCount 1 ;
			sh:minCount 1 ;
		] 
		sh:property [
			sh:name "Count Nodes class"@en ;
			
			sh:path sh:nodes ;
			sh:maxCount 1 ;
		] 
	) .	


adsh:RuleTypeShape					# Rule-type
	a sh:NodeShape ;
	sh:targetSubjectsOf sh:rule ;
	sh:message "Each SHACL rule has at least one rdf:type which is a IRI."@en ;
	
	rdfs:comment "Requirements for rdf:type property in sh:rule class."@en ;
	rdfs:label "Rule Type Shape"@en ;
	
	sh:and (
		sh:property [
			sh:name "Count rdf type at Rule class"@en ;
			sh:path (sh:rule rdf:type) ;
			sh:maxCount 1 ;
			sh:minCount 1 ;
		] 
		sh:property [
			sh:name "Node kind of rdf type at Rule class"@en ;
			sh:path (sh:rule rdf:type) ;
			sh:nodeKind sh:IRI ;
		] 
	) .	


adsh:OrderShape					
	a sh:NodeShape ;
	sh:targetSubjectsOf sh:order ;
	
	rdfs:comment "Requirements for subjects of sh:order class."@en ;
	rdfs:label "Order Shape"@en ;
	
	sh:property [					# rule-order-maxCount
		sh:name "Count Order class"@en ;
		
		sh:path sh:order ;
		sh:maxCount 1 ;
		sh:message "Each rule or shape may have at most one value for the property sh:order."@en ;
	] ;
	sh:property [					# rule-order-datatype
		sh:name "Datatype Order class"@en ;
		
		sh:path sh:order ;
		sh:nodeKind sh:Literal ;
		sh:or ( [ sh:datatype xsd:decimal ] [ sh:datatype xsd:integer ] [ sh:datatype xsd:byte ] [ sh:datatype xsd:int ] [ sh:datatype xsd:long ] [ sh:datatype xsd:negativeInteger ] [ sh:datatype xsd:nonNegativeInteger ] [ sh:datatype xsd:nonPositiveInteger ] [ sh:datatype xsd:positiveInteger ] [ sh:datatype xsd:shortunsignedLong ] [ sh:datatype xsd:unsignedInt ] [ sh:datatype xsd:unsignedShort ] [ sh:datatype xsd:unsignedByte ] ) ; 	
		sh:message "The values of sh:order at rules and shapes are literals with a numeric datatype such as xsd:decimal."@en ;
	] .
	

adsh:RuleDeactivatedShape					
	a sh:NodeShape ;
	sh:targetSubjectsOf sh:rule ;
	
	rdfs:comment "Requirements for sh:deactivated property in sh:rule class."@en ;
	rdfs:label "Order Shape"@en ;
	
	sh:property [
		sh:name "Count Deactivated at Rule class"@en ;
		
		sh:path (sh:rule sh:deactivated) ;		# deactivated-maxCount
		sh:maxCount 1 ;
		sh:message "Each rule may have at most one value for the property sh:deactivated."@en ;
	] ;
	
	sh:property [								# deactivated-in
		sh:name "Datatype Deactivated at Rule class"@en ;
		
		sh:path (sh:rule sh:deactivated) ;
		sh:nodeKind sh:Literal ;
		sh:datatype xsd:boolean ;
		sh:message "The values of sh:deactivated are either of the xsd:boolean literals true or false."@en ;
	] .
	
adsh:SPARQLRuleShape					
	a sh:NodeShape ;
	sh:targetClass sh:SPARQLRule ;
	
	rdfs:comment "Requirements for sh:SPARQLRule class."@en ;
	rdfs:label "SPARQL Rule Shape"@en ;
	
	sh:property [								# construct-count
		sh:name "Count Construct at SPARQL Rule class"@en ;
		
		sh:path sh:construct ;
		sh:maxCount 1 ;
		sh:minCount 1 ;
		sh:message "SPARQL rules must have exactly one value for the property sh:construct."@en ;
	] ;
	
	sh:property [								# construct-count
		sh:name "Dataype construct at SPARQL Rule class"@en ;
		
		sh:path sh:construct ;
		sh:nodeKind sh:Literal ;
		sh:datatype xsd:string ;
		sh:message "The values of sh:construct are literals with datatype xsd:string."@en ;
	] .


adsh:TripleRuleShape
	a sh:NodeShape ;
	sh:targetClass sh:TripleRule ;
	
	rdfs:comment "Requirements for sh:TripleRule class."@en ;
	rdfs:label "Triple Rule Shape"@en ;
	
	sh:property [
		sh:name "Count Subject at Triple Rule class"@en ;
		
		sh:path sh:subject ;		# tripleRule-subject
		sh:maxCount 1 ;
		sh:minCount 1 ;
		sh:message "Each triple rule must have exactly one value of the property sh:subject (which must be a well-formed node expression)."@en ;
	] ;
	
	sh:property [
		sh:name "Count Predicate at Triple Rule class"@en ;
		
		sh:path sh:predicate ;		# tripleRule-predicate
		sh:maxCount 1 ;
		sh:minCount 1 ;
		sh:message "Each triple rule must have exactly one value of the property sh:predicate (which must be a well-formed node expression)."@en ;
	] ;
	
	sh:property [
		sh:name "Count Object at Triple Rule class"@en ;
		
		sh:path sh:object ;			# tripleRule-object
		sh:maxCount 1 ;
		sh:minCount 1 ;
		sh:message "Each triple rule must have exactly one value of the property sh:object (which must be a well-formed node expression)."@en ;
	] .
	
